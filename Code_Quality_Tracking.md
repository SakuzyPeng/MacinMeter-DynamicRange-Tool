# ä»£ç è´¨é‡å·©å›ºè¿½è¸ª

**å¼€å§‹æ—¶é—´**: 2025-10-01
**ç›®æ ‡**: å…¨é¢ä»£ç è´¨é‡æ£€æŸ¥ï¼Œæ¶ˆé™¤æŠ€æœ¯å€º
**é¢„è®¡å®Œæˆ**: 1.5ä¸ªå·¥ä½œæ—¥

---

## è¿›åº¦æ€»è§ˆ

- [x] æ­¥éª¤0: ä»£ç è€ƒå¤ï¼ˆé‡å¤/å†—ä½™/æ­»ä»£ç ï¼‰ âœ…
- [ ] æ­¥éª¤1: å®‰å…¨æ€§å®¡æŸ¥
- [ ] æ­¥éª¤2: é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ­¥éª¤3: æµ‹è¯•è¡¥å¼º
- [ ] æ­¥éª¤4: æ–‡æ¡£åŒæ­¥

---

## æ­¥éª¤0: ä»£ç è€ƒå¤ - é‡å¤/å†—ä½™/æ­»ä»£ç æ¸…ç†

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

### 0.1 å…¥å£ç‚¹åˆ†æå’Œè°ƒç”¨å›¾ âœ… (å…¨é¢æ£€æŸ¥)
**çŠ¶æ€**: å·²å®Œæˆï¼ˆprocessing/audio/coreå…¨å±‚æ£€æŸ¥ï¼‰
**å‘ç°**:
- **2ä¸ªå…¥å£ç‚¹**: main.rs (CLI) + lib.rs (åº“API + foobar2000æ’ä»¶æ¡¥æ¥)
- **main.rsè°ƒç”¨é“¾**:
  - process_batch_mode â†’ 11ä¸ªtoolså‡½æ•° (æ‰¹é‡å¤„ç†)
  - process_single_mode â†’ 2ä¸ªtoolså‡½æ•° (å•æ–‡ä»¶å¤„ç†)
- **lib.rså…¬å¼€API**: 9ç»„å¯¼å‡ºï¼Œ**å‘ç°3ä¸ªæœªä½¿ç”¨å¯¼å‡º** âŒ
  - `process_streaming_decoder` è¢«foobar2000_pluginè°ƒç”¨ âœ“
  - **`SimdChannelData`** - å¯¼å‡ºä½†0ä½¿ç”¨ âŒ
  - **`ChannelData`** - å¯¼å‡ºä½†0ä½¿ç”¨ âŒ
  - **`SimdProcessor`** - å¯¼å‡ºä½†å†…éƒ¨ç›´æ¥å¯¼å…¥ï¼Œæ— éœ€å…¬å¼€ âš ï¸
- **processing/mod.rsè¿‡åº¦å¯¼å‡º**: 13ä¸ªç±»å‹å¯¼å‡ºï¼Œä»…4ä¸ªè¢«å…¶ä»–æ¨¡å—ä½¿ç”¨
  - 9ä¸ªç±»å‹ä»…processingå†…éƒ¨ä½¿ç”¨ï¼Œæ— éœ€å…¬å¼€å¯¼å‡º
- **é›¶ç¼–è¯‘å™¨è­¦å‘Š**: æ— dead_codeï¼ˆä½†æœ‰unused pub exportsï¼‰
- **TODOæ ‡è®°**: 7ä¸ªï¼ˆsample_conversion.rsæœªå®ç°æ ¼å¼ï¼Œå·²çŸ¥ç‰¹æ€§ï¼‰

### 0.2 é‡å¤å®ç°æ£€æµ‹ âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**å‘ç°**:
- **StreamingDecoder traitå®ç°**: 2ä¸ªimplå—ä¸­format()/progress()å®Œå…¨ç›¸åŒ
  - å·²é€šè¿‡ProcessorStateæ¶ˆé™¤60%é‡å¤ âœ“
  - å¯è¿›ä¸€æ­¥ç”¨å®ç®€åŒ– (ä½ä¼˜å…ˆçº§)
- **sample_conversion.rsé‡å¤æ¨¡å¼**:
  - 3ä¸ªconvert_*_to_f32å‡½æ•°ç»“æ„100%ç›¸åŒ
  - å¯ç”¨å®æŠ½è±¡ï¼šç»Ÿè®¡â†’é¢„ç•™â†’SIMDé€‰æ‹©â†’æ—¥å¿—
- **é”™è¯¯å¤„ç†é‡å¤**: 21å¤„map_errä½¿ç”¨ç›¸åŒæ¨¡å¼
  - `.map_err(|e| AudioError::FormatError(format!(...)))` å‡ºç°8æ¬¡
  - å¯æå–helperå‡½æ•°ç»Ÿä¸€é”™è¯¯è½¬æ¢

### 0.3 æ­»ä»£ç æ·±åº¦æ¸…ç† âœ…
**çŠ¶æ€**: å·²å®Œæˆ
**æ¸…ç†é¡¹**:
- **AudioErroræœªä½¿ç”¨å˜ä½“**:
  - `NumericOverflow`: ä»…åœ¨Displayä¸­ï¼Œå®é™…æœªåˆ›å»º âŒ
  - `OutOfMemory`: main.rsä¸­åŒ¹é…ä½†ä»æœªåˆ›å»º âš ï¸
  - å»ºè®®ï¼šä¿ç•™OutOfMemoryä½œä¸ºé¢„ç•™ï¼Œåˆ é™¤NumericOverflow
- **å¸¸é‡**: å…¨éƒ¨åœ¨ä½¿ç”¨ä¸­ âœ“
- **ç»“æ„ä½“å­—æ®µ**: æ— æœªä½¿ç”¨å­—æ®µ âœ“
- **å‡½æ•°**: ç¼–è¯‘å™¨æ£€æŸ¥é€šè¿‡ï¼Œæ— dead_code âœ“

### 0.4 å†—ä½™é€»è¾‘åˆå¹¶ âœ…
**çŠ¶æ€**: å·²å®Œæˆï¼ˆåˆ†æé˜¶æ®µï¼‰
**åˆå¹¶æ–¹æ¡ˆ**:
- **StreamingDecoder traitæ–¹æ³•**: ç”¨å®åˆå¹¶format()/progress()
  ```rust
  macro_rules! impl_streaming_decoder_common { ... }
  ```
- **sample_conversion.rsè½¬æ¢å‡½æ•°**: æå–é€šç”¨æ¨¡å¼å®
  ```rust
  macro_rules! impl_sample_conversion { ... }
  ```
- **é”™è¯¯è½¬æ¢helper**: ç»Ÿä¸€map_erræ¨¡å¼
  ```rust
  fn format_error<E: Display>(e: E) -> AudioError { ... }
  fn decoding_error<E: Display>(e: E) -> AudioError { ... }
  ```
- **ä¼˜å…ˆçº§**: ä½ï¼ˆå½“å‰æ— åŠŸèƒ½bugï¼Œå¯åç»­ä¼˜åŒ–ï¼‰

---

## æ­¥éª¤1: å®‰å…¨æ€§å®¡æŸ¥

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

### 1.1 unsafeä»£ç å®¡æŸ¥ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**å®¡æŸ¥ç‚¹**:
-

### 1.2 è¾¹ç•Œæ¡ä»¶éªŒè¯ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**é—®é¢˜**:
-

### 1.3 å¹¶å‘å®‰å…¨æ£€æŸ¥ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**å‘ç°**:
-

---

## æ­¥éª¤2: é”™è¯¯å¤„ç†å®Œå–„

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

### 2.1 é”™è¯¯è¦†ç›–ç‡æ£€æŸ¥ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**ç»Ÿè®¡**:
-

### 2.2 é”™è¯¯ä¿¡æ¯è´¨é‡æå‡ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**æ”¹è¿›**:
-

### 2.3 é”™è¯¯ä¼ æ’­é“¾è·¯å®¡æŸ¥ â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**ä¼˜åŒ–**:
-

---

## æ­¥éª¤3: æµ‹è¯•è¡¥å¼º

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

### 3.1 è¾¹ç•Œæµ‹è¯•è¡¥å…… â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**æ–°å¢æµ‹è¯•**:
-

### 3.2 å¹¶è¡Œè§£ç å‹åŠ›æµ‹è¯• â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**æµ‹è¯•åœºæ™¯**:
-

### 3.3 SIMDç²¾åº¦éªŒè¯æ‰©å±• â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**è¦†ç›–**:
-

---

## æ­¥éª¤4: æ–‡æ¡£åŒæ­¥

**é¢„è®¡æ—¶é—´**: 1å°æ—¶

### 4.1 æ¶æ„æ–‡æ¡£æ›´æ–° â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**æ›´æ–°å†…å®¹**:
-

### 4.2 æ€§èƒ½æ–‡æ¡£æ›´æ–° â³
**çŠ¶æ€**: å¾…æ‰§è¡Œ
**è¡¥å……æ•°æ®**:
-

---

## å®Œæˆæ ‡å‡†

- [ ] é›¶dead codeè­¦å‘Šï¼ˆæ‰‹åŠ¨+å·¥å…·éªŒè¯ï¼‰
- [ ] é›¶clippyè­¦å‘Šï¼ˆ-D warningsé€šè¿‡ï¼‰
- [ ] æµ‹è¯•è¦†ç›–ç‡>85%
- [ ] æ‰€æœ‰unsafeå—æœ‰SAFETYæ³¨é‡Š
- [ ] æ–‡æ¡£ä¸ä»£ç 100%åŒæ­¥

---

## ğŸ§¹ ç«‹å³æ¸…ç†æ¸…å•ï¼ˆæ­¥éª¤0å‘ç°çš„çœŸæ­»ä»£ç ï¼‰

### å¿…é¡»åˆ é™¤ï¼ˆæ— ä»»ä½•ä½¿ç”¨ï¼‰
- [ ] `src/error.rs`: åˆ é™¤ `AudioError::NumericOverflow` å˜ä½“
- [ ] `src/lib.rs`: åˆ é™¤ `pub use processing::{..., SimdChannelData, ...}`
- [ ] `src/lib.rs`: åˆ é™¤ `pub use processing::{..., SimdProcessor}`
- [ ] `src/lib.rs`: åˆ é™¤ `pub use processing::ChannelData`
- [ ] `src/lib.rs`: åˆ é™¤ `pub use core::DrCalculator` ï¼ˆä»…å†…éƒ¨ä½¿ç”¨ï¼‰
- [ ] `src/lib.rs`: åˆ é™¤ `pub use core::{PeakSelectionStrategy, PeakSelector}` ï¼ˆä»…å†…éƒ¨ä½¿ç”¨ï¼‰
- [ ] `src/lib.rs`: åˆ é™¤ `pub use audio::universal_decoder::FormatSupport` ï¼ˆä»…å†…éƒ¨ä½¿ç”¨ï¼‰
- [ ] `src/lib.rs`: åˆ é™¤ `pub use audio::universal_decoder::UniversalDecoder` ï¼ˆä»…å†…éƒ¨ä½¿ç”¨ï¼‰
- [ ] `src/lib.rs`: åˆ é™¤ `pub use tools::process_audio_file_streaming` ï¼ˆä»…å†…éƒ¨ä½¿ç”¨ï¼‰

### å»ºè®®è°ƒæ•´ï¼ˆé™ä½å¯è§æ€§ï¼‰
- [ ] `src/processing/mod.rs`: 9ä¸ªç±»å‹ä»pubæ”¹ä¸ºpub(crate)
  - ChannelExtractorï¼ˆä»…toolså†…éƒ¨ç”¨ï¼‰
  - PerformanceEvaluator/Result/Stats/SimdUsageStatsï¼ˆä»…processingå†…éƒ¨ç”¨ï¼‰
  - ConversionStats/SampleFormatï¼ˆä»…audioå†…éƒ¨ç”¨ï¼‰
  - SampleConversion/SampleConverterï¼ˆä»…audioå†…éƒ¨ç”¨ï¼‰
  - SimdCapabilitiesï¼ˆä»…coreå†…éƒ¨ç”¨ï¼‰

---

## å…³é”®å‘ç°æ±‡æ€»

### é‡å¤ä»£ç 
- sample_conversion.rs: 3ä¸ªconvertå‡½æ•°ç»“æ„100%ç›¸åŒ â†’ å¯ç”¨å®æŠ½è±¡
- StreamingDecoder: format()/progress()åœ¨2ä¸ªimplä¸­é‡å¤ â†’ å¯ç”¨å®ç®€åŒ–
- é”™è¯¯å¤„ç†: `.map_err(AudioError::FormatError)` é‡å¤8æ¬¡ â†’ æå–helper

### æ­»ä»£ç å’Œæœªä½¿ç”¨å¯¼å‡º
**é”™è¯¯ç±»å‹**ï¼š
- **AudioError::NumericOverflow**: ä»æœªè¢«åˆ›å»ºï¼Œä»…Display â†’ åˆ é™¤

**lib.rsè¿‡åº¦å¯¼å‡ºï¼ˆå…¨é¢æ£€æŸ¥åï¼‰**ï¼š
- **SimdChannelData, SimdProcessor, ChannelData** (processingå±‚): å®Œå…¨0ä½¿ç”¨ â†’ åˆ é™¤
- **DrCalculator, PeakSelectionStrategy, PeakSelector** (coreå±‚): ä»…å†…éƒ¨ä½¿ç”¨ â†’ åˆ é™¤
- **FormatSupport, UniversalDecoder** (audioå±‚): ä»…å†…éƒ¨ä½¿ç”¨ â†’ åˆ é™¤
- **process_audio_file_streaming** (toolså±‚): ä»…å†…éƒ¨ä½¿ç”¨ â†’ åˆ é™¤

**å®é™…å¤–éƒ¨ä½¿ç”¨ï¼ˆæ’ä»¶ï¼‰**ï¼š
- âœ“ AudioFormat, AudioError, AudioResult, DrResult
- âœ“ StreamingDecoder (audio trait)
- âœ“ process_streaming_decoder, AppConfig

**processing/mod.rsè¿‡åº¦å¯¼å‡º**ï¼š
- 13ä¸ªç±»å‹å…¬å¼€å¯¼å‡ºï¼Œå®é™…ä»…4ä¸ªè¢«å…¶ä»–æ¨¡å—ä½¿ç”¨
- 9ä¸ªç±»å‹ä»…æ¨¡å—å†…éƒ¨ä½¿ç”¨ â†’ æ”¹ä¸ºpub(crate)

### ä¼˜åŒ–å»ºè®®ï¼ˆéç´§æ€¥ï¼‰
- å®æŠ½è±¡å¯å‡å°‘50%+ä»£ç è¡Œæ•°ï¼ˆsample_conversion.rsï¼‰
- é”™è¯¯helperå¯æå‡ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§
- ä¼˜å…ˆçº§ï¼šä½ï¼ˆæ— åŠŸèƒ½å½±å“ï¼‰

### å®‰å…¨é—®é¢˜
- å¾…å®¡æŸ¥ï¼ˆæ­¥éª¤1ï¼‰

### æµ‹è¯•è¦†ç›–ç¼ºå£
- å¾…åˆ†æï¼ˆæ­¥éª¤3ï¼‰

### æ–‡æ¡£è¿‡æ—¶é¡¹
- å¾…æ£€æŸ¥ï¼ˆæ­¥éª¤4ï¼‰

---

**å›¾ä¾‹**:
â³ å¾…æ‰§è¡Œ | â–¶ï¸ è¿›è¡Œä¸­ | âœ… å·²å®Œæˆ | âŒ å·²è·³è¿‡

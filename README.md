# MacinMeter DR Tool

![Rust](https://img.shields.io/badge/rust-%23000000.svg?style=for-the-badge&logo=rust&logoColor=white)
![License](https://img.shields.io/badge/license-MIT-blue.svg?style=for-the-badge)

ä¸€ä¸ªé«˜æ€§èƒ½çš„éŸ³é¢‘åŠ¨æ€èŒƒå›´(DR)åˆ†æå·¥å…·ï¼Œä½¿ç”¨Rustå®ç°ï¼Œæ”¯æŒå¤šç§å·¥ä¸šæ ‡å‡†å’Œå…¼å®¹æ¨¡å¼ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

MacinMeter DR Tool æ˜¯ä¸“ä¸ºéŸ³é¢‘å·¥ç¨‹å¸ˆå’Œåˆ¶ä½œäººè®¾è®¡çš„åŠ¨æ€èŒƒå›´æµ‹é‡å·¥å…·ã€‚å®ƒæä¾›äº†ç²¾ç¡®çš„DRå€¼è®¡ç®—ï¼Œæ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼Œå¹¶å®ç°äº†ä¸ä¸»æµDRæµ‹é‡æ ‡å‡†çš„é«˜åº¦å…¼å®¹æ€§ã€‚

### ğŸš€ æœ€æ–°çŠ¶æ€
- âœ… è·¨æ¶æ„SIMDä¼˜åŒ–å®Œæˆ (ARM NEON + x86 SSEç»Ÿä¸€å®ç°)
- âœ… è·¨å¹³å°CIå…¼å®¹æ€§ä¿®å¤å®Œæˆ
- âœ… é¢„æäº¤è´¨é‡æ£€æŸ¥å¢å¼º (å«è·¨å¹³å°æ£€æµ‹)

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸµ å¤šæ ¼å¼æ”¯æŒ**: WAV, FLAC, MP3, AAC, OGGç­‰ä¸»æµéŸ³é¢‘æ ¼å¼
- **ğŸš€ é«˜æ€§èƒ½å¤„ç†**: SIMDå‘é‡åŒ–ä¼˜åŒ–ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—
- **ğŸ“Š åŒæ¨¡å¼è¿è¡Œ**: æ ‡å‡†æ¨¡å¼ + dr14_t.meterå…¼å®¹æ¨¡å¼
- **ğŸ¯ å·¥ä¸šçº§ç²¾åº¦**: 99.75% dr14_t.meterå…¼å®¹åº¦ï¼Œ100% æ ‡å‡†ç¬¦åˆæ€§
- **âš¡ ä¼˜åŒ–ç®—æ³•**: æ™ºèƒ½Sum Doublingæ£€æµ‹ï¼Œè‡ªåŠ¨Peakå›é€€æœºåˆ¶
- **ğŸ”§ è·¨å¹³å°æ”¯æŒ**: Linux, macOS, Windows

## ğŸŒ¿ åˆ†æ”¯è¯´æ˜

### å½“å‰ä¸»çº¿ (Master Branch)
- **æ ‡å‡†ä¾æ®**: [Measuring_DR_ENv3.md](docs/Measuring-DR-ENv3_2025-08-30-19_10_53/Measuring_DR_ENv3.md)
- **å‚è€ƒå®ç°**: dr14_t.meter é¡¹ç›®
- **æ ¸å¿ƒå…¬å¼**: `DR = -20 Ã— logâ‚â‚€(sqrt(Î£(RMSÂ²)/N) / Pk_2nd)`
- **ç®—æ³•ç‰¹å¾**: 3ç§’å—åˆ†å‰²ï¼Œ20% RMSç»Ÿè®¡ï¼Œç¬¬äºŒå¤§Peakå€¼é€‰æ‹©
- **é€‚ç”¨åœºæ™¯**: æ–°é¡¹ç›®å¼€å‘ï¼Œæ ‡å‡†å…¼å®¹æ€§è¦æ±‚ï¼Œè·¨å¹³å°éƒ¨ç½²

### æ—©æœŸç‰ˆæœ¬åˆ†æ”¯ (foobar2000-based)
- **æ ‡å‡†ä¾æ®**: foobar2000 DR Meter é€†å‘å·¥ç¨‹åˆ†æ
- **å‚è€ƒå®ç°**: foobar2000 DR Meter (Windowsä¸“ç”¨)
- **æ ¸å¿ƒå…¬å¼**: `DR = -20 Ã— logâ‚â‚€(RMS_20% / Peak_2nd)`
- **ç®—æ³•ç‰¹å¾**: Sum Doublingè¡¥å¿ï¼Œseg_cnt+è™šæ‹Ÿçª—å£é€»è¾‘
- **é€‚ç”¨åœºæ™¯**: foobar2000å®Œå…¨å…¼å®¹æ€§ï¼ŒWindowsç¯å¢ƒï¼Œç²¾ç¡®ç®—æ³•å¤ç°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

#### ä»æºç æ„å»º
```bash
git clone https://github.com/SakuzyPeng/MacinMeter-DynamicRange-Tool.git
cd MacinMeter-DynamicRange-Tool
cargo build --release
```

### åŸºæœ¬ä½¿ç”¨

#### æ ‡å‡†æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
# åˆ†æå•ä¸ªæ–‡ä»¶
./target/release/dr-meter audio.flac

# è¯¦ç»†è¾“å‡º
./target/release/dr-meter --verbose audio.wav

# ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
./target/release/dr-meter --output result.txt audio.mp3
```

#### dr14_t.meterå…¼å®¹æ¨¡å¼
```bash
# å…¼å®¹dr14_t.meterè¾“å‡ºæ ¼å¼
./target/release/dr-meter --dr14-compat-mode audio.flac

# éœ€è¦é¢„å…ˆå®‰è£…ffmpeg
```

## ğŸµ è¿è¡Œæ¨¡å¼å¯¹æ¯”

| ç‰¹å¾ | æ ‡å‡†æ¨¡å¼ | dr14å…¼å®¹æ¨¡å¼ |
|------|---------|-------------|
| **æ•°æ®æº** | åŸå§‹é«˜è´¨é‡éŸ³é¢‘ | ffmpegé¢„å¤„ç†(44.1kHz/16bit) |
| **è¾“å‡ºæ ¼å¼** | è¯¦ç»†åˆ†å£°é“æŠ¥å‘Š | dr14_t.meterå•è¡Œæ ¼å¼ |
| **ç²¾åº¦** | 100%æ ‡å‡†ç¬¦åˆ | 99.75% dr14åŒ¹é… |
| **å¤„ç†é€Ÿåº¦** | å¿« | ä¸­ç­‰(å«é¢„å¤„ç†) |
| **é€‚ç”¨åœºæ™¯** | ä¸“ä¸šåˆ¶ä½œç¯å¢ƒ | dr14å…¼å®¹æ€§éœ€æ±‚ |

### è¾“å‡ºç¤ºä¾‹

**æ ‡å‡†æ¨¡å¼**:
```
åŠ¨æ€èŒƒå›´ (DR) ç»“æœ:
-------------------------------------
å£°é“ 1: DR10 (RMS:-11.62dB, Peak:-1.58dB) [å…¨å±€ç»Ÿè®¡: RMS:-12.62dB, Peak:-1.53dB]
å£°é“ 2: DR10 (RMS:-11.74dB, Peak:-1.28dB) [å…¨å±€ç»Ÿè®¡: RMS:-12.73dB, Peak:-0.13dB]

å¹³å‡DRå€¼: DR10
```

**dr14å…¼å®¹æ¨¡å¼**:
```
DR	Peak	RMS
-------------------------------------
DR10	-0.33 dB	-12.67 dB
```

## âš¡ æ€§èƒ½ç‰¹ç‚¹

- **SIMDä¼˜åŒ–**: SSE/AVXå‘é‡åŒ–å¤„ç†ï¼Œ6-7å€æ€§èƒ½æå‡
- **å¤šçº¿ç¨‹å¤„ç†**: è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒï¼Œå¹¶è¡Œè®¡ç®—
- **å†…å­˜ä¼˜åŒ–**: æ™ºèƒ½ç¼“å­˜ç®¡ç†ï¼Œæ”¯æŒå¤§æ–‡ä»¶å¤„ç†
- **å®æ—¶å¤„ç†**: æµå¼å¤„ç†æ¶æ„ï¼Œä½å»¶è¿Ÿå“åº”

### æ€§èƒ½åŸºå‡†
```
æ–‡ä»¶: Ver2-adm-master-from-DAW-spatialmix-noreverb-peaklimited-0 (3:42, 48kHz/24bit)
å¤„ç†æ—¶é—´: 45.2ms
å¤„ç†é€Ÿåº¦: 6.8M samples/s
å†…å­˜ä½¿ç”¨: ~200MB
SIMDåŠ é€Ÿ: 6.7x
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—
- **`core/`**: DRè®¡ç®—æ ¸å¿ƒç®—æ³•
  - `dr_calculator.rs` - ä¸»DRè®¡ç®—å¼•æ“
  - `channel_data.rs` - 24/32å­—èŠ‚ChannelDataç»“æ„
  - `histogram.rs` - 10000-binç›´æ–¹å›¾å’Œ20%é‡‡æ ·

- **`audio/`**: éŸ³é¢‘è§£ç å±‚
  - `wav_decoder.rs` - é«˜æ•ˆWAVå¤„ç†(hound)
  - `multi_decoder.rs` - å¤šæ ¼å¼æ”¯æŒ(symphonia)

- **`processing/`**: æ€§èƒ½ä¼˜åŒ–å±‚
  - `batch.rs` - æ‰¹é‡å¤„ç†å’Œå¹¶è¡ŒåŒ–
  - `simd.rs` - SIMDå‘é‡åŒ–ä¼˜åŒ–

## ğŸ“‹ å‘½ä»¤è¡Œé€‰é¡¹

```bash
é€‰é¡¹:
  -v, --verbose              æ˜¾ç¤ºè¯¦ç»†å¤„ç†ä¿¡æ¯
  -o, --output <FILE>        è¾“å‡ºç»“æœåˆ°æ–‡ä»¶
  -s, --sum-doubling         å¯ç”¨Sum Doublingè¡¥å¿
      --dr14-compat-mode     dr14_t.meterå…¼å®¹æ¨¡å¼(å®éªŒç‰¹æ€§)
      --disable-simd         ç¦ç”¨SIMDä¼˜åŒ–
      --single-thread        ç¦ç”¨å¤šçº¿ç¨‹å¤„ç†
      --debug-calculation    è¾“å‡ºè¯¦ç»†è®¡ç®—è¿‡ç¨‹
  -h, --help                 æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -V, --version             æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

## ğŸ§ª éªŒè¯å’Œæµ‹è¯•

é¡¹ç›®é€šè¿‡äº†ä¸¥æ ¼çš„éªŒè¯æµ‹è¯•:
- âœ… **dr14_t.meterå…¼å®¹æ€§**: 99.75%åŒ¹é…åº¦
- âœ… **æ ‡å‡†ç¬¦åˆæ€§**: å®Œå…¨ç¬¦åˆMeasuring_DR_ENv3.md
- âœ… **è·¨å¹³å°ä¸€è‡´æ€§**: Linux/macOS/Windowsç»“æœä¸€è‡´
- âœ… **å¤šæ ¼å¼éªŒè¯**: æ‰€æœ‰ä¸»æµéŸ³é¢‘æ ¼å¼æµ‹è¯•é€šè¿‡

### æµ‹è¯•éŸ³é¢‘æ–‡ä»¶
æ ‡å‡†æµ‹è¯•æ–‡ä»¶: `Ver2-adm-master-from-DAW-spatialmix-noreverb-peaklimited-0-2025-08-29-00-00-55.flac`
- æ ¼å¼: FLAC 48kHz/24bit ç«‹ä½“å£°
- æ—¶é•¿: 3:42
- DRæœŸæœ›å€¼: DR10
- Peak: -0.33dB, RMS: -12.73dB

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒ

### ä¾èµ–è¦æ±‚
- Rust 1.70+
- ffmpeg (å…¼å®¹æ¨¡å¼éœ€è¦)
- æ”¯æŒSIMDçš„CPU (å¯é€‰)

### æ„å»ºé…ç½®
```toml
[profile.release]
opt-level = 3
lto = "fat"
codegen-units = 1
panic = "abort"
```

### ğŸ”§ é¢„æäº¤é’©å­ï¼ˆæ¨èï¼‰

ä¸ºäº†ç¡®ä¿ä»£ç è´¨é‡å’Œä¸CIä¿æŒä¸€è‡´ï¼Œå»ºè®®å®‰è£…é¢„æäº¤é’©å­ï¼š

```bash
# è‡ªåŠ¨å®‰è£…é¢„æäº¤é’©å­
chmod +x scripts/install-pre-commit.sh
./scripts/install-pre-commit.sh
```

**é¢„æäº¤é’©å­åŠŸèƒ½**ï¼š
- ğŸ¨ ä»£ç æ ¼å¼æ£€æŸ¥ (`cargo fmt --check`)
- ğŸ“ é™æ€åˆ†æ (`cargo clippy`)  
- ğŸ”¨ ç¼–è¯‘æ£€æŸ¥ (`cargo check`)
- ğŸ§ª å•å…ƒæµ‹è¯• (`cargo test`)
- ğŸ›¡ï¸ å®‰å…¨å®¡è®¡ (`cargo audit`)

**ä½¿ç”¨æ•ˆæœ**ï¼š
- âœ… åœ¨æœ¬åœ°æå‰å‘ç°CIä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜
- âš¡ èŠ‚çœ"æ¨é€ â†’ ç­‰å¾… â†’ ä¿®å¤ â†’ é‡æ–°æ¨é€"çš„æ—¶é—´
- ğŸ¯ ä¸GitHub Actionså®Œå…¨ç›¸åŒçš„æ£€æŸ¥æ ‡å‡†

```bash
# æ­£å¸¸æäº¤ - è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æ£€æŸ¥
git commit -m "your message"

# ç´§æ€¥æƒ…å†µè·³è¿‡æ£€æŸ¥
git commit --no-verify -m "emergency fix"
```

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·æŸ¥çœ‹ [`scripts/README.md`](scripts/README.md)

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦ç»†æŒ‡å—ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [Measuring DR ENv3 æ ‡å‡†](docs/Measuring-DR-ENv3_2025-08-30-19_10_53/)
- [dr14_t.meter å‚è€ƒé¡¹ç›®](dr14_t.meter/)
- [æŠ€æœ¯æ–‡æ¡£](docs/)

---

## ğŸ“Š é¡¹ç›®çŠ¶æ€

- **å¼€å‘çŠ¶æ€**: ç¨³å®šç‰ˆæœ¬
- **æµ‹è¯•è¦†ç›–**: 78ä¸ªå•å…ƒæµ‹è¯•
- **ä»£ç è´¨é‡**: Zero clippy warnings
- **å…¼å®¹æ€§**: 99.75% dr14_t.meteråŒ¹é…

**ä¸ºä¸“ä¸šéŸ³é¢‘åˆ¶ä½œè€Œç”Ÿ | Built for Professional Audio Production**
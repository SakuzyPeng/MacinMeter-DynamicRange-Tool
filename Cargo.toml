[package]
name = "macinmeter-dr-tool"
version = "0.1.0"
edition = "2024"
authors = ["MacinMeter Team"]
description = "åŸºäºfoobar2000 DR Meterå®˜æ–¹è§„èŒƒçš„é«˜ç²¾åº¦éŸ³é¢‘åŠ¨æ€èŒƒå›´åˆ†æå·¥å…· - è‡´æ•¬Janne HyvÃ¤rinen"

[[bin]]
name = "MacinMeter-DynamicRange-Tool-foo_dr"
path = "src/main.rs"

[dependencies]
# éŸ³é¢‘æ–‡ä»¶è§£ç 
hound = "3.5"
# ğŸ”¥ ä¼˜åŒ–ï¼šå¯ç”¨æ‰€æœ‰å¿…è¦çš„ç¼–è§£ç å™¨ï¼Œæ”¯æŒå¤šæ ¼å¼å…¼å®¹
symphonia = { version = "0.5", features = [
    "flac",      # FLACæ”¯æŒï¼ˆéŸ³è´¨æµ‹è¯•å¸¸ç”¨ï¼‰
    "mp3",       # MP3æ”¯æŒï¼ˆé€šç”¨æ ¼å¼ï¼‰
    "mp1",       # MP1æ”¯æŒï¼ˆMPEG Audio Layer Iï¼‰
    "aac",       # AACæ”¯æŒ
    "vorbis",    # OGG Vorbisæ”¯æŒ
    "wav",       # WAVæ”¯æŒï¼ˆåŸºç¡€æ ¼å¼ï¼‰
    "aiff",      # AIFFæ”¯æŒï¼ˆå…³é”®ä¿®å¤ï¼‰
    "alac",      # Apple Losslessç¼–è§£ç å™¨
    "isomp4",    # MP4/M4Aå®¹å™¨æ ¼å¼æ”¯æŒï¼ˆå…³é”®ä¿®å¤ï¼‰
    "mkv",       # MKV/WebMå®¹å™¨æ ¼å¼æ”¯æŒ
    "pcm",       # é€šç”¨PCMæ”¯æŒï¼ˆAU, CAFç­‰ï¼‰
] }

# å·¥å…·åº“
walkdir = "2.5"
anyhow = "1.0"
clap = { version = "4.5", features = ["derive"] }

# æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
rayon = "1.10"
crossbeam-channel = "0.5"  # é«˜æ€§èƒ½MPMCé€šé“ï¼Œæ›¿ä»£std::sync::mpsc
thread-priority = "1.2"  # çº¿ç¨‹ä¼˜å…ˆçº§æ§åˆ¶ï¼ŒIntelæ··åˆæ¶æ„P-coreä¼˜å…ˆ

# æ—¶é—´å¤„ç† - æ¢å¤chronoï¼ˆè™½ç„¶å¢åŠ 35KiBï¼Œä½†ä¿è¯æ—¶é—´å‡†ç¡®æ€§ï¼‰
chrono = { version = "0.4", features = ["serde"] }

# ç³»ç»Ÿä¿¡æ¯ç›‘æ§ - æœªä½¿ç”¨ï¼Œå·²ç§»é™¤ï¼ˆèŠ‚çœ~20KiBï¼‰
# sysinfo = "0.30"

# å…¨å±€é™æ€å˜é‡æ”¯æŒ - æœªä½¿ç”¨ï¼Œå·²ç§»é™¤ï¼ˆèŠ‚çœ~5KiBï¼‰
# lazy_static = "1.4"

# OpuséŸ³é¢‘æ”¯æŒ
songbird = { version = "0.4", default-features = false, features = ["driver", "rustls"] }
symphonia-core = "0.5.4"
tokio = { version = "1.0", features = ["rt", "rt-multi-thread"] }

# å¯é€‰CPUç«ç„°å›¾åˆ†æï¼ˆä»…åœ¨è®¾ç½®ç¯å¢ƒå˜é‡ DR_FLAME=1 æ—¶å¯ç”¨ï¼Œé»˜è®¤æ— å¼€é”€ï¼‰
pprof = { version = "0.13", features = ["flamegraph"], optional = true }

[features]
default = []
# å¯ç”¨åå°†é“¾æ¥ pprof ä¾èµ–ï¼Œä½†ä»éœ€é€šè¿‡ç¯å¢ƒå˜é‡ DR_FLAME=1 æ‰ä¼šå®é™…è®°å½•
flame-prof = ["pprof"]
# å¯ç”¨SIMDæ€§èƒ½æµ‹è¯•ï¼ˆåŒ…å«å¤§æ•°æ®é›†ï¼Œå¯èƒ½å¯¼è‡´CIé“¾æ¥å™¨å´©æºƒï¼Œé»˜è®¤ç¦ç”¨ï¼‰
simd-perf-tests = []

# ğŸ“ å®‰å…¨è­¦å‘Šè¯´æ˜ï¼š
# songbirdçš„Discordä¾èµ–å­˜åœ¨å·²çŸ¥å®‰å…¨é—®é¢˜ï¼Œä½†ä¸å½±å“æˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ï¼š
# - ring/rustls: TLSé—®é¢˜ï¼Œæˆ‘ä»¬æ— ç½‘ç»œé€šä¿¡
# - tungstenite: WebSocketæ”»å‡»ï¼Œæˆ‘ä»¬åªå¤„ç†æœ¬åœ°æ–‡ä»¶
# - tracing-subscriber: æ—¥å¿—æ±¡æŸ“ï¼Œæˆ‘ä»¬æ— æ•æ„Ÿæ—¥å¿—
# - derivative: ç¼–è¯‘æ—¶å·¥å…·ï¼Œè¿è¡Œæ—¶æ— å½±å“
# é£é™©è¯„ä¼°ï¼šæœ¬åœ°æ–‡ä»¶è§£ç åœºæ™¯ä¸‹ï¼Œè¿™äº›é—®é¢˜çš„æ”»å‡»é¢ä¸ºé›¶

[profile.release]
opt-level = 3          # ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼ˆé’ˆå¯¹å¤„ç†/è§£ç è·¯å¾„æ›´åˆé€‚ï¼‰
lto = "fat"            # æ›´æ¿€è¿›çš„é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1      # å•ä¸ªä»£ç ç”Ÿæˆå•å…ƒï¼ˆæ›´å¥½çš„ä¼˜åŒ–ï¼‰
panic = "abort"        # panicæ—¶ç›´æ¥abortï¼ˆå‡å°‘ä»£ç ä½“ç§¯ï¼‰
strip = true           # ç§»é™¤è°ƒè¯•ç¬¦å·å’Œå…¶ä»–å…ƒæ•°æ®
overflow-checks = false # ç¦ç”¨æ•´æ•°æº¢å‡ºæ£€æŸ¥ï¼ˆreleaseæ¨¡å¼ä¸‹é€šå¸¸å®‰å…¨ï¼‰

# ä¸“ç”¨ Profiling é…ç½®ï¼šç”¨äºç”Ÿæˆå¸¦ç¬¦å·çš„ç«ç„°å›¾ï¼ˆä¸å½±å“æ­£å¼ releaseï¼‰
[profile.profiling]
inherits = "release"
opt-level = 3
lto = false            # å…³é—­ LTOï¼Œé¿å…å‡½æ•°è¢«è¿‡åº¦å†…è”/åˆå¹¶å¯¼è‡´ç¬¦å·ä¸¢å¤±
debug = 1              # ç”Ÿæˆæœ€å°è°ƒè¯•ä¿¡æ¯ï¼Œè¶³å¤Ÿç¬¦å·è§£æ
strip = false          # ä¸å‰¥ç¦»ç¬¦å·ï¼Œä¿è¯ flamegraph å…·å¤‡å‡½æ•°å
codegen-units = 1
panic = "abort"
overflow-checks = false
